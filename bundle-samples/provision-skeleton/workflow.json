{
  "name": "provision-skeleton-bundle",
  "version": 1,
  "description": "Bundle-based provisioning skeleton workflow",
  "details": "Demonstrates script activities packaged inside a zip bundle with an approval wait state.",
  "steps": [
    {
      "stepId": "CreateProject",
      "displayName": "Create Project",
      "activityRef": "create-project.sh",
      "inputs": {
        "projectId": { "binding": "$.inputs.projectId" }
      },
      "scriptParameters": [
        { "name": "projectId", "required": true }
      ],
      "outputsSchema": ["projectNumber"],
      "retryPolicy": {
        "maxAttempts": 3,
        "initialDelaySeconds": 2,
        "maxDelaySeconds": 30,
        "backoffFactor": 2.0
      },
      "abortOnFail": true,
      "timeoutSeconds": 60,
      "safetyMetadata": {
        "createsResources": true,
        "changesIam": false
      }
    },
    {
      "stepId": "RequestApproval",
      "displayName": "Request Approval",
      "activityRef": "",
      "inputs": {},
      "outputsSchema": ["approved"],
      "retryPolicy": {
        "maxAttempts": 3,
        "initialDelaySeconds": 2,
        "maxDelaySeconds": 30,
        "backoffFactor": 2.0
      },
      "waitForEvent": {
        "eventType": "approval",
        "correlationKeyExpression": "$.instanceId"
      },
      "abortOnFail": true,
      "safetyMetadata": {
        "createsResources": false,
        "changesIam": false
      }
    },
    {
      "stepId": "CreateServiceAccounts",
      "displayName": "Create Service Accounts",
      "activityRef": "create-service-accounts.sh",
      "inputs": {
        "projectNumber": { "binding": "$.steps.CreateProject.outputs.projectNumber" }
      },
      "scriptParameters": [
        { "name": "projectNumber", "required": true }
      ],
      "outputsSchema": ["serviceAccountCount"],
      "retryPolicy": {
        "maxAttempts": 3,
        "initialDelaySeconds": 2,
        "maxDelaySeconds": 30,
        "backoffFactor": 2.0
      },
      "abortOnFail": true,
      "timeoutSeconds": 60,
      "safetyMetadata": {
        "createsResources": true,
        "changesIam": true
      }
    },
    {
      "stepId": "Finalize",
      "displayName": "Finalize Provisioning",
      "activityRef": "finalize.sh",
      "inputs": {
        "projectNumber": { "binding": "$.steps.CreateProject.outputs.projectNumber" },
        "approved": { "binding": "$.steps.RequestApproval.outputs.approved" },
        "serviceAccounts": { "binding": "$.steps.CreateServiceAccounts.outputs.serviceAccountCount" }
      },
      "scriptParameters": [
        { "name": "approved", "required": true },
        { "name": "serviceAccounts", "required": true }
      ],
      "outputsSchema": ["result"],
      "retryPolicy": {
        "maxAttempts": 3,
        "initialDelaySeconds": 2,
        "maxDelaySeconds": 30,
        "backoffFactor": 2.0
      },
      "abortOnFail": true,
      "timeoutSeconds": 60,
      "safetyMetadata": {
        "createsResources": false,
        "changesIam": false
      }
    }
  ]
}
